---
date: "2019-08-21T10:38:36+02:00"
title: Person analyses
weight: 12
---



<p>After cleaning the data, there are three sections of the template that produce tabular, graphic, and cartographic (map) analysis outputs.</p>
<p>This first section produces descriptive analyses about the patients demographics and attack rates.</p>
<div id="demographic-tables" class="section level3">
<h3>Demographic Tables:</h3>
<p>The person analysis section begins with a couple sentences that contain <strong>in-line code</strong> - code embedded in normal RMarkdown text (not within an R code chunk). The second sentence <strong>in-line code</strong> inserts the number of males and females by counting the observations with “Male” and “Female” in the variable <code>sex</code>. <strong>Because our dataset’s variable <code>sex</code> contains <code>M</code> and <code>F</code> instead, we must modify this in-line code (or modify our variable) so the <code>fmt_count()</code> function is searching for the correct terms.</strong></p>
<p>The first demographic table presents patients by their age group (the table’s rows) and their relationship with the case definition (the table’s columns). This chunk uses piping to link six different functions and produce a table (<code>%&gt;%</code> is the pipe operator - see the R Basics <a href="https://r4epis.netlify.com/training/r_basics/advanced_functions/">Advanced and Miscellaneous</a> page):</p>
<ul>
<li>The <code>tab_linelist()</code> function creates a frequency and percent table of <code>age_group</code>, with columns differentiating by <code>case_def</code> value<br />
</li>
<li>The <code>select()</code> function removes an unnecessary column “variable” generated by <code>tab_linelist()</code>.<br />
</li>
<li>The <code>rename()</code> function renames the default column “value” as “Age Group”<br />
</li>
<li>The <code>rename_redundant()</code> function replaces any column name that has proportion with “%”<br />
</li>
<li>The <code>augment_redundant()</code> command replaces any column name with n with &quot; cases (n)&quot;<br />
</li>
<li>The <code>kable()</code> command completes the table, in this case with one digit after each decimal</li>
</ul>
<pre class="r"><code># Describe observations by age_group and case_def
tab_linelist(linelist_cleaned, 
             age_group, strata = case_def, 
             col_total = TRUE, row_total = TRUE) %&gt;%
  select(-variable) %&gt;%
  rename(&quot;Age group&quot; = value) %&gt;%
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; cases (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">Confirmed cases (n)</th>
<th align="right">%</th>
<th align="right">Probable cases (n)</th>
<th align="right">%</th>
<th align="right">Suspected cases (n)</th>
<th align="right">%</th>
<th align="right">Missing cases (n)</th>
<th align="right">%</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">4</td>
<td align="right">4.0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">40</td>
<td align="right">5.8</td>
<td align="right">23</td>
<td align="right">3.7</td>
<td align="right">67</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">30</td>
<td align="right">30.3</td>
<td align="right">1</td>
<td align="right">16.7</td>
<td align="right">284</td>
<td align="right">40.9</td>
<td align="right">320</td>
<td align="right">50.9</td>
<td align="right">635</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">46</td>
<td align="right">46.5</td>
<td align="right">2</td>
<td align="right">33.3</td>
<td align="right">246</td>
<td align="right">35.4</td>
<td align="right">180</td>
<td align="right">28.6</td>
<td align="right">474</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">15</td>
<td align="right">15.2</td>
<td align="right">2</td>
<td align="right">33.3</td>
<td align="right">95</td>
<td align="right">13.7</td>
<td align="right">76</td>
<td align="right">12.1</td>
<td align="right">188</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">4</td>
<td align="right">4.0</td>
<td align="right">1</td>
<td align="right">16.7</td>
<td align="right">29</td>
<td align="right">4.2</td>
<td align="right">30</td>
<td align="right">4.8</td>
<td align="right">64</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">99</td>
<td align="right">100.0</td>
<td align="right">6</td>
<td align="right">100.0</td>
<td align="right">694</td>
<td align="right">100.0</td>
<td align="right">629</td>
<td align="right">100.0</td>
<td align="right">1428</td>
</tr>
</tbody>
</table>
<p>You can change the argument <code>strata =</code> to refer to any number of variables (in this next example, <code>sex</code>). To show proportions of the total population of observations, add the argument <code>prop_total =</code> specified as <code>TRUE</code>, as below.</p>
<pre class="r"><code>tab_linelist(linelist_cleaned, 
             age_group, strata = sex,
             col_total = TRUE, row_total = TRUE, prop_total = TRUE) %&gt;% 
  select(-variable) %&gt;%
  rename(&quot;Age group&quot; = value) %&gt;%
#  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; cases (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">F cases (n)</th>
<th align="right">F proportion</th>
<th align="right">M cases (n)</th>
<th align="right">M proportion</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">26</td>
<td align="right">1.8</td>
<td align="right">41</td>
<td align="right">2.9</td>
<td align="right">67</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">222</td>
<td align="right">15.5</td>
<td align="right">413</td>
<td align="right">28.9</td>
<td align="right">635</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">316</td>
<td align="right">22.1</td>
<td align="right">158</td>
<td align="right">11.1</td>
<td align="right">474</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">118</td>
<td align="right">8.3</td>
<td align="right">70</td>
<td align="right">4.9</td>
<td align="right">188</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">32</td>
<td align="right">2.2</td>
<td align="right">32</td>
<td align="right">2.2</td>
<td align="right">64</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">714</td>
<td align="right">50.0</td>
<td align="right">714</td>
<td align="right">50.0</td>
<td align="right">1428</td>
</tr>
</tbody>
</table>
<p>You can also choose to exclude or edit the <strong>in-line code</strong> that gives a count of the missing cases by sex and age_group.</p>
</div>
<div id="age-pyramids" class="section level3">
<h3>Age pyramids</h3>
<p>To print an age pyramid in your report, use the code below. A few things to note:</p>
<ul>
<li>The <strong>variable for <code>split_by =</code> should have two non-missing value options</strong> (e.g. Male or Female, Oui or Non, etc. Three will create a messy output.)<br />
</li>
<li>The variable names work with or without quotation marks<br />
</li>
<li>The dashed lines in the bars are the midpoint of the un-stratified age group<br />
</li>
<li>You can adjust the position of the legend by replacing <code>legend.position = &quot;bottom&quot;</code> with “top”, “left”, or “right”<br />
</li>
<li>Read more by searching “plot_age_pyramid”&quot; in the Help tab of the lower-right RStudio pane</li>
</ul>
<p>You can make this a pyramid of months by supplying <code>age_group_mon</code> to the <code>age_group =</code> argument.</p>
<pre class="r"><code># plot age pyramid by sex 
plot_age_pyramid(linelist_cleaned, 
                 age_group = &quot;age_group&quot;, 
                 split_by = &quot;sex&quot;) + 
  labs(y = &quot;Cases (n)&quot;, x = &quot;Age group&quot;) + # change axis  labels (nb. x/y flip)
  theme(legend.position = &quot;bottom&quot;,     # move legend to bottom
        legend.title = element_blank(), # remove title
        text = element_text(size = 18)  # change text size
       )</code></pre>
<p><img src="/training/Walk-through/person_analyses_files/figure-html/age_pyramid-1.png" width="720" /></p>
<p><strong>To have an age pyramid of patients under 2 by month age groups, it is best to add a <code>filter()</code> step to the beginning of the code chunk, as below</strong>. This selects for <code>linelist_cleaned</code> observations that meet the specified critera and passes that reduced dataset through the “pipes” to the next function: (<code>plot_age_pyramid()</code>). If this <code>filter()</code> step is not added, you will see that the largest pyramid bars are of “missing”. These are the patients old enough to not have a months age group.</p>
<p>If you add this filtering step, <strong>you must also modify <code>plot_age_pyramid()</code> by removing its first argument <code>linelist_cleaned,</code></strong>. The dataset is already given to the command in the <code>filter()</code> and is passed to <code>plot_age_pyramid()</code> via piping.</p>
<p>Note that the filter step does not drop any observations from the <code>linelist_cleaned</code> object itself. Because the filter is <strong>not</strong> being assigned (<code>&lt;-</code>) to over-write <code>linelist_cleaned</code>, this filter is only temporarily applied for the purpose of producing the age pyramid.</p>
<pre class="r"><code># plot age pyramid by month groups, for observations under 2 years
filter(linelist_cleaned, age_years &lt;= 2) %&gt;%
  plot_age_pyramid(age_group = &quot;age_group_mon&quot;,
                   split_by = &quot;sex&quot;) +
                  # stack_by = &quot;case_def&quot;) +
  labs(y = &quot;Cases (n)&quot;, x = &quot;Age group (months)&quot;) + # change axis  labels (nb. x/y flip)
  theme(legend.position = &quot;bottom&quot;,     # move legend to bottom
        legend.title = element_blank(), # remove title
        text = element_text(size = 18)  # change text size
       )</code></pre>
<p><img src="/training/Walk-through/person_analyses_files/figure-html/age_pyramid_under_two-1.png" width="720" /></p>
</div>
<div id="inpatient-statistics" class="section level3">
<h3>Inpatient statistics</h3>
<p>The text following the age pyramids uses <strong>in-line code</strong> to describe the distribution of outpatient and inpatient observations, and descriptive statistics of the length of stay for inpatients. <strong>The Am Timan dataset does not have length of stay, so it is best to delete those related sentences related to <code>obs_days</code> for the final report</strong>.</p>
</div>
<div id="symptom-and-lab-descriptive-tables" class="section level3">
<h3>Symptom and lab descriptive tables</h3>
<p>This next code also uses the <code>tab_linelist()</code> function to <strong>create descriptive tables of all the variables that were included in the <code>SYMPTOMS</code> variable list</strong>.</p>
<ul>
<li>In the <code>tab_linelist()</code> function, <code>SYMPTOMS</code> (the value supplied to the second argument) is an object we defined in data cleaning that is a list of variables to tabulate. If this code produces an error about an “Unknown column”, ensure that the variables in the object <code>SYMPTOMS</code> are <em>all</em> present in your dataset (and spelled correctly).</li>
<li>Also in <code>tab_linelist()</code>, the argument <code>keep =</code> must represent the character value to be counted for the the table. As these Am Timan variables are still in French, <strong>we change <code>keep = &quot;Yes&quot;</code> to <code>keep = &quot;Oui&quot;</code></strong>.<br />
</li>
<li>The <code>mutate()</code> function is aesthetically changing variable names with underscores to spaces.</li>
</ul>
<pre class="r"><code># get counts and proportions for all variables named in SYMPTOMS
tab_linelist(linelist_cleaned, SYMPTOMS, keep = &quot;Oui&quot;) %&gt;% 
  select(-value) %&gt;%
  # fix the way symptom names are displayed
  mutate(variable = str_to_sentence(str_replace_all(variable, &quot;_&quot;, &quot; &quot;))) %&gt;%
  # rename accordingly
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">n</th>
<th align="right">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Generalized itch</td>
<td align="right">512</td>
<td align="right">64.6</td>
</tr>
<tr class="even">
<td align="left">Fever</td>
<td align="right">668</td>
<td align="right">84.0</td>
</tr>
<tr class="odd">
<td align="left">Joint pains</td>
<td align="right">240</td>
<td align="right">30.5</td>
</tr>
<tr class="even">
<td align="left">Epigastric pain heartburn</td>
<td align="right">469</td>
<td align="right">59.2</td>
</tr>
<tr class="odd">
<td align="left">Nausea anorexia</td>
<td align="right">425</td>
<td align="right">53.5</td>
</tr>
<tr class="even">
<td align="left">Vomiting</td>
<td align="right">457</td>
<td align="right">57.6</td>
</tr>
<tr class="odd">
<td align="left">Diarrhoea</td>
<td align="right">112</td>
<td align="right">14.2</td>
</tr>
<tr class="even">
<td align="left">Bleeding</td>
<td align="right">52</td>
<td align="right">6.6</td>
</tr>
<tr class="odd">
<td align="left">Headache</td>
<td align="right">633</td>
<td align="right">80.0</td>
</tr>
</tbody>
</table>
<p>The code for the lab table is very similar, but has this difference:</p>
<ul>
<li>In the initial <code>tab_linelist()</code> command, <code>transpose = &quot;value&quot;</code> is set because the values in the lab data are important in-and-of themselves (e.g. IgM+/IgG-, etc.) - i.e. the values should become column headers.</li>
</ul>
<p>{{% notice tip %}}
This table may be large and unwieldy at first, until you clean your data. The step in data cleaning where we converted 0, 1, “yes”, “pos”, “neg”, etc. to standardized “Positive” and “Negative” was crucial towards making this table readable. Once knitted into a word document, you will likely need to adjust the font size, column widths, etc.
{{% /notice %}}</p>
<pre class="r"><code># get counts and proportions for all variables named in LABS
tab_linelist(linelist_cleaned, LABS, 
             transpose = &quot;value&quot;) %&gt;% 
  # fix the way lab test names are displayed
  mutate(variable = str_to_sentence(str_replace_all(variable, &quot;_&quot;, &quot; &quot;))) %&gt;%
  # rename accordingly
  rename(&quot;Lab test&quot; = variable) %&gt;%
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Lab test</th>
<th align="right">Negative (n)</th>
<th align="right">%</th>
<th align="right">Positive (n)</th>
<th align="right">%</th>
<th align="right">IgG-/IgM- (n)</th>
<th align="right">%</th>
<th align="right">IgG-/IgM+ (n)</th>
<th align="right">%</th>
<th align="right">IgG+/IgM- (n)</th>
<th align="right">%</th>
<th align="right">IgG+/IgM+ (n)</th>
<th align="right">%</th>
<th align="right">IgG±/IgM- (n)</th>
<th align="right">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hep b rdt</td>
<td align="right">222</td>
<td align="right">91.7</td>
<td align="right">20</td>
<td align="right">8.3</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Hep c rdt</td>
<td align="right">239</td>
<td align="right">99.2</td>
<td align="right">2</td>
<td align="right">0.8</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Hep e rdt</td>
<td align="right">149</td>
<td align="right">59.8</td>
<td align="right">100</td>
<td align="right">40.2</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Test hepatitis a</td>
<td align="right">23</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Test hepatitis b</td>
<td align="right">22</td>
<td align="right">95.7</td>
<td align="right">1</td>
<td align="right">4.3</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Test hepatitis c</td>
<td align="right">23</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Test hepatitis e igm</td>
<td align="right">21</td>
<td align="right">33.9</td>
<td align="right">41</td>
<td align="right">66.1</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Test hepatitis e genotype</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">2</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Test hepatitis e virus</td>
<td align="right">7</td>
<td align="right">11.3</td>
<td align="right">1</td>
<td align="right">1.6</td>
<td align="right">9</td>
<td align="right">14.5</td>
<td align="right">14</td>
<td align="right">22.6</td>
<td align="right">5</td>
<td align="right">8.1</td>
<td align="right">26</td>
<td align="right">41.9</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Malaria rdt at admission</td>
<td align="right">160</td>
<td align="right">63.5</td>
<td align="right">92</td>
<td align="right">36.5</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Dengue</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">12</td>
<td align="right">52.2</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">10</td>
<td align="right">43.5</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">1</td>
<td align="right">4.3</td>
</tr>
<tr class="even">
<td align="left">Yellow fever</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">18</td>
<td align="right">78.3</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">5</td>
<td align="right">21.7</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Chikungunya onyongnyong</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">20</td>
<td align="right">87.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">3</td>
<td align="right">13.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Other arthropod transmitted virus</td>
<td align="right">23</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
</tbody>
</table>
</div>
<div id="case-fatality-ratio-cfr" class="section level2">
<h2>Case Fatality Ratio (CFR)</h2>
<p>The opening text of this chunk with in-line code must be edited to match our Am Timan data. The second in-line code references the variable <code>exit_status</code> - <strong>this must now reference the variable <code>exit_status2</code></strong>. Also, we do not have Dead on Arrival recorded in our dataset, so <strong>that part of the sentence should be deleted</strong>.</p>
<p>Likewise, <strong>the code section on time-to-death does not apply to our dataset and should be deleted.</strong></p>
<p>Overall CFR is produced with the code below. Note the following:</p>
<ul>
<li>This code requires the variable <code>patient_facility_type</code>, that it has a value “Inpatient”, and the <code>DIED</code> variable.<br />
</li>
<li>A filter is applied that restricts this table to Inpatient observations only.<br />
</li>
<li><code>rename()</code> is used to change the column labels in the table</li>
</ul>
<pre class="r"><code># use arguments from above to produce overal CFR
overall_cfr &lt;- linelist_cleaned %&gt;% 
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  case_fatality_rate_df(deaths = DIED, mergeCI = TRUE) %&gt;%
  rename(&quot;Deaths&quot; = deaths,
         &quot;Cases&quot; = population,
         &quot;CFR (%)&quot; = cfr,
         &quot;95%CI&quot; = ci)
  knitr::kable(overall_cfr, digits = 1)         # print nicely with 1 decimal digit</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
<p>The next code adds arguments to <code>case_fatality_rate_df()</code> such as <code>group = sex</code> (which stratified the CFR by sex), and <code>add_total = TRUE</code> (which makes a total row across the sex groups).</p>
<pre class="r"><code>linelist_cleaned %&gt;%
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  mutate(sex = forcats::fct_explicit_na(sex, &quot;-&quot;)) %&gt;%
  case_fatality_rate_df(deaths = DIED, group = sex, mergeCI = TRUE, add_total = TRUE) %&gt;%
  rename(&quot;Sex&quot; = sex, 
         &quot;Deaths&quot; = deaths, 
         &quot;Cases&quot; = population, 
         &quot;CFR (%)&quot; = cfr, 
         &quot;95%CI&quot; = ci) %&gt;% 
  knitr::kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Sex</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="right">11</td>
<td align="right">55</td>
<td align="right">20.0</td>
<td align="left">(11.55–32.36)</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="right">2</td>
<td align="right">31</td>
<td align="right">6.5</td>
<td align="left">(1.79–20.72)</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
<p>When creating a table of CFR by age groups, one additional step, using the function <code>complete()</code> is required to ensure that all <code>age_group</code> levels are shown even if they have no observations.</p>
<pre class="r"><code>linelist_cleaned %&gt;%
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  case_fatality_rate_df(deaths = DIED, group = age_group, mergeCI = TRUE, add_total = TRUE) %&gt;%
  tidyr::complete(age_group, 
                  fill = list(deaths = 0, 
                              population = 0, 
                              cfr = 0, 
                              ci = 0)) %&gt;% # Ensure all levels are represented
  rename(&quot;Age group&quot; = age_group, 
         &quot;Deaths&quot; = deaths, 
         &quot;Cases&quot; = population, 
         &quot;CFR (%)&quot; = cfr, 
         &quot;95%CI&quot; = ci) %&gt;% 
  knitr::kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">4</td>
<td align="right">11</td>
<td align="right">36.4</td>
<td align="left">(15.17–64.62)</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">1</td>
<td align="right">17</td>
<td align="right">5.9</td>
<td align="left">(1.05–26.98)</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">13.9</td>
<td align="left">(6.08–28.66)</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">11.8</td>
<td align="left">(3.29–34.34)</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">25.0</td>
<td align="left">(4.56–69.94)</td>
</tr>
<tr class="even">
<td align="left">(Missing)</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.0</td>
<td align="left">(0.00–79.35)</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
<p>The commented code below examines <strong>CFR by case definition</strong>. Note that this is dependant upon our working <code>case_def</code> variable.</p>
<pre class="r"><code># Use if you have enough confirmed cases for comparative analysis 

 linelist_cleaned %&gt;%
   filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
   case_fatality_rate_df(deaths = DIED, group = case_def, mergeCI = TRUE, add_total = TRUE) %&gt;%
   rename(&quot;Case definition&quot; = case_def, 
          &quot;Deaths&quot; = deaths, 
          &quot;Cases&quot; = population, 
          &quot;CFR (%)&quot; = cfr, 
          &quot;95%CI&quot; = ci) %&gt;% 
   knitr::kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Case definition</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Confirmed</td>
<td align="right">8</td>
<td align="right">44</td>
<td align="right">18.2</td>
<td align="left">(9.51–31.96)</td>
</tr>
<tr class="even">
<td align="left">Suspected</td>
<td align="right">5</td>
<td align="right">42</td>
<td align="right">11.9</td>
<td align="left">(5.19–25.00)</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
</div>
<div id="attack-rate" class="section level2">
<h2>Attack Rate</h2>
<p>To use the attack rate section, we need to modify the first code slightly. An object <code>population</code> is created from the sum of population counts in the population figures. <strong>Because we only imported region-based population counts, we must change this command</strong> to reflect that we do not have <code>population_data_age</code>, but rather <code>population_data_region</code>.</p>
<pre class="r"><code># OLD command from template 
# population &lt;- sum(population_data_age$population)</code></pre>
<p>Running the correct command and printing the value of population, we see that the sum population across regions is estimated to be 62336.</p>
<pre class="r"><code># CORRECTED command for Am Timan exercise
population &lt;- sum(population_data_region$population)

population</code></pre>
<pre><code>## [1] 62336</code></pre>
<p>The first line of code below creates a multi-part object <code>ar</code> with the number of cases, population, attack rate per 10,000, and lower and upper confidence intervals (you can run just this line to verify yourself). The subsequent commands alter the aesthetics of to produce a neat table with appropriate column names.</p>
<pre class="r"><code># calculate the attack rate information and store them in object &quot;ar&quot;&quot;
ar &lt;- attack_rate(nrow(linelist_cleaned), population, multiplier = 10000)

# Create table from the information in the object &quot;ar&quot;&quot;
ar %&gt;%
  merge_ci_df(e = 3) %&gt;% # merge the lower and upper CI into one column
  rename(&quot;Cases (n)&quot; = cases, 
         &quot;Population&quot; = population, 
         &quot;AR (per 10,000)&quot; = ar, 
         &quot;95%CI&quot; = ci) %&gt;% 
  select(-Population) %&gt;% # drop the population column as it is not changing
  knitr::kable(digits = 1, align = &quot;r&quot;)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Cases (n)</th>
<th align="right">AR (per 10,000)</th>
<th align="right">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1436</td>
<td align="right">230.4</td>
<td align="right">(218.88–242.44)</td>
</tr>
</tbody>
</table>
<p>We are unable to calculate the attack rate by age group, because we do not have population counts for each age group. <strong>Comment out (#) this code.</strong></p>
<p>Mortality attributable to AJS is also not appropriate for this example. <strong>Comment out (#) the 4 related code chunks.</strong></p>
</div>
